# X.509 Identity Management

The purpose of this component is to provide x.509 identification for final dojot entities, that is, *IoT devices* that communicate with the dojot IoT platform.

X.509 certificates represent the identity of the IoT device for the dojot platform. Such certificates are installed with the devices and presented by them when establishing communication over TLS with the platform.
The platform keeps track of the device associated with an X.509 certificate. Therefore, although it is possible to issue a certificate without necessarily associating it with a device right away, so that this device can actually send and receive data from the platform, there needs to be a *Certificate-Device* relationship and the *X.509 Identity Management* component provides the interfaces for this.

Certificates issued by the dojot platform are signed by an internal CA, so it is also necessary for the device to recognize the dojot CA as being trusted. In a simplified way, the device must have installed the certificate issued to it and the certificate of the CA that signed it. The details are part of the [TLS protocol](https://tools.ietf.org/html/rfc5246).

It is important that you see the [README](./js/README.md) of the Node.js application settings.

It is important that you see the [README](./ejbca/README.md) of the EJBCA Server custom settings for the dojot platform.


## Component architecture

The component is written in javascript and runs on the Node.js interpreter. It makes use of the [EJBCA server](https://www.ejbca.org/) for issuing certificates, which in turn needs to be connected to a [Postgres](https://www.postgresql.org/) database to store its settings centrally. Both applications run within the same [Docker](https://www.docker.com/) container and together form the **x509-identity-mgmt** component.
The component stores the certificates and their association with the devices into [MongoDB](https://www.mongodb.com/).<br>
It is located behind the [API Gateway](https://github.com/dojot/kong) of the dojot platform.

![Component architecture](./examples/component-architecture.png?raw=true)

## Usage

### How to obtain a certificate

To obtain a certificate it is necessary to inform the CSR for the dojot platform.
CSR (Certificate Signing Request) is a text file generated by the user (owner of the device) containing the information to request your certificate securely, being used to generate a digitally signed certificate.

#### Generate a CSR

The user is responsible for generating a CSR, and for that, he needs tools for this, one of which (and perhaps the most common) is [OpenSSL](https://www.openssl.org/). In this example we will use this tool to generate a CSR on the user's computer.

With OpenSSL installed on the user's computer (Linux in this case), just type the command below in the terminal:

    openssl req -newkey rsa:2048 -nodes -sha256 -keyout private.key -out request.csr -subj "/CN=[!!!device identifier here!!!]"

Explaining this command in detail:

| command snippet                            | description |
|--------------------------------------------|-------------|
| openssl req                                | PKCS#10 certificate request utility |
| -newkey rsa:2048                           | creates a new CSR and a new private key. The argument **rsa:*nbits*** means that the algorithm used for the generation of the key pair will be RSA, where nbits is the size of the keys, in this case, the minimum accepted value for RSA is 2048 bits.|
| -nodes                                     | If this option is specified then if a private key is created it will not be encrypted (a.k.a. No DES). |
| -sha256                                    | This specifies the message digest to sign the request. |
| -keyout private.key                        | This gives the filename to write the newly created private key to. |
| -out request.csr                           | This specifies the output filename to write the CSR to |
| -subj "/CN=[!!!device identifier here!!!]" | Sets subject name for new request. <br> **Important note**: Only the CN (CommonName) is required. The value of this field must match the *device identifier*. The dojot platform is responsible for adding the correct *tenant*. In this way, the *Certificate-Device* relationship is made. |

For more details, just consult the tool manual:

    man openssl-req

Upon completion of the command, two files will be generated, one of which is the `private.key` and *must be stored with the device in a very secure way*. The other is the CSR `request.csr` and it must be sent to the dojot platform in order to obtain an x.509 certificate.

In this example, we saw how to generate a CSR whose key pair was derived from the RSA algorithm. This algorithm, in order to be considered secure, needs to generate keys of at least 2048 bits (really very large keys).
For IoT devices the ideal is to use pairs of keys derived from elliptical curves (smaller keys, but with the same level of security). The dojot platform currently supports the curves recommended by [NIST](https://www.nist.gov/), namely: P-256, P-384 or P-521.
Below are the commands needed to generate each of these curves:

##### P-256
    openssl ecparam -genkey -name prime256v1 -noout -out ec256-key-pair.pem
    openssl req -new -key ec256-key-pair.pem -out ec256-key-pair.csr -sha256 -subj "/CN=[[device ID]]"

##### P-384
    openssl ecparam -genkey -name secp384r1 -noout -out ec384-key-pair.pem
    openssl req -new -key ec384-key-pair.pem -out ec384-key-pair.csr -sha256 -subj "/CN=[[device ID]]"

##### P-521
    openssl ecparam -genkey -name secp521r1 -noout -out ec512-key-pair.pem
    openssl req -new -key ec512-key-pair.pem -out ec512-key-pair.csr -sha256 -subj "/CN=[[device ID]]"


#### Submit the CSR to the dojot platform

CSR submission must be done at endpoint `/api/v1/certificates` of the *X.509 Identity Management* component, but as in practice the component is behind an API Gateway, the URI becomes `http://localhost:8000/x509/v1/certificates`.
Therefore, you must send the CSR according to the syntax:

    POST <base-url>/v1/certificates
    Authorization: Bearer JWT
    Content-type: application/json
    {
        "csr": <string>
    }

Now the details come in, as we can see, the CSR generated by OpenSSL is nothing more than a text file, but it has the following format:

    -----BEGIN CERTIFICATE REQUEST-----
    MIICVjCCAT4CAQAwETEPMA0GA1UEAwwGMTIzNDU2MIIBIjANBgkqhkiG9w0BAQEF
    AAOCAQ8AMIIBCgKCAQEAxbuzcHie/XjSsE5FN9GcXdfZbAAZDWAFyQ6n8q7Lk+vH
    nkd5xs9LskKRBEkLNDm/KOtiV7y9A55wGuTCvMrfqfU4pbSRDkF0zG66LxSZw0fO
    Qa2RUBG8gisq8/VkEw8AhKr9+tnZ5HMCwXdgzmw/Dr0YP1M7laEgO7ZbEM2gEs6S
    LVCRQrhisx2tLW907a4YM+EPVj14DjnSrC4OqaLshkhGlysiIQHKy1I75znEoyW6
    OOvsuYk3pluZJt4DXWyDVZbghtx1UO82aS6GmL+OO1lLxTzDEnkQGDUc9kKATrfL
    HqH3MFb7q3HLZrS+VhZWDQh/ng5HRR1Mt8XVa7Im0wIDAQABoAAwDQYJKoZIhvcN
    AQELBQADggEBAK41QA2ACotztfGAP18rG0iSOWdxoFlPGB/Qra9owNCaM60my58K
    Y8PA8WlY/Nfmke/0ZM1Qed3VGM9SOWmIOSnKSapNMnnMQ5wg1ebetPxm6RU6kMJw
    sqZ7n8xENm5/TXEfz7lg1/djU9yfMZAPs0bK8430oFfchx1kPMpM8w3fcOKgo2ii
    rc7HwKVbyQTstkuPiNEQzlFM2JtqTuqDDt+Mv1cA2yRrW+LtjuWfuzu1nMjA7F1j
    9GWtb/7Jta18oGNfHGZF3nPpRj9FkZJWYwFNq+O95Qsq1I6XWCwTfeFJF8BQYEBK
    Arduy9FzNG50zzJX0yYI/blzBL/EA27Vvr4=
    -----END CERTIFICATE REQUEST-----

Note that this format consists of a header and a footer, the CSR is encoded in *Base64* in the middle. Also note that each line has a maximum of 64 bytes.
As we have to send this file in a JSON payload, it is necessary to represent the line breaks with the `\r\n` markers.
That done, we will have the following payload:

    {
    	"csr": "-----BEGIN CERTIFICATE REQUEST-----\r\nMIICVjCCAT4CAQAwETEPMA0GA1UEAwwGMTIzNDU2MIIBIjANBgkqhkiG9w0BAQEF\r\nAAOCAQ8AMIIBCgKCAQEAxbuzcHie/XjSsE5FN9GcXdfZbAAZDWAFyQ6n8q7Lk+vH\r\nnkd5xs9LskKRBEkLNDm/KOtiV7y9A55wGuTCvMrfqfU4pbSRDkF0zG66LxSZw0fO\r\nQa2RUBG8gisq8/VkEw8AhKr9+tnZ5HMCwXdgzmw/Dr0YP1M7laEgO7ZbEM2gEs6S\r\nLVCRQrhisx2tLW907a4YM+EPVj14DjnSrC4OqaLshkhGlysiIQHKy1I75znEoyW6\r\nOOvsuYk3pluZJt4DXWyDVZbghtx1UO82aS6GmL+OO1lLxTzDEnkQGDUc9kKATrfL\r\nHqH3MFb7q3HLZrS+VhZWDQh/ng5HRR1Mt8XVa7Im0wIDAQABoAAwDQYJKoZIhvcN\r\nAQELBQADggEBAK41QA2ACotztfGAP18rG0iSOWdxoFlPGB/Qra9owNCaM60my58K\r\nY8PA8WlY/Nfmke/0ZM1Qed3VGM9SOWmIOSnKSapNMnnMQ5wg1ebetPxm6RU6kMJw\r\nsqZ7n8xENm5/TXEfz7lg1/djU9yfMZAPs0bK8430oFfchx1kPMpM8w3fcOKgo2ii\r\nrc7HwKVbyQTstkuPiNEQzlFM2JtqTuqDDt+Mv1cA2yRrW+LtjuWfuzu1nMjA7F1j\r\n9GWtb/7Jta18oGNfHGZF3nPpRj9FkZJWYwFNq+O95Qsq1I6XWCwTfeFJF8BQYEBK\r\nArduy9FzNG50zzJX0yYI/blzBL/EA27Vvr4=\r\n-----END CERTIFICATE REQUEST-----"
    }

That way, we can now send the CSR to the dojot platform and issue us a certificate!

#### Obtain the certificate issued by the dojot platform

If all goes well, the dojot platform will issue an x.509 certificate to the CSR previously informed, the answer given by the *X.509 Identity Management* component will have the following syntax:

    HTTP/1.1 201 Created
    Content-type: application/json
    {
        "certificateFingerprint": <string>,
        "certificatePem": <string>
    }

In practice, we will have something similar to this:

    HTTP/1.1 201 Created
    Content-type: application/json

    {
      "certificateFingerprint": "27:98:B3:A2:69:28:2C:C3:00:E2:2C:7D:48:50:94:C4:4A:F7:A2:1C:63:B8:06:7F:69:15:01:F6:EA:09:34:2D",
      "certificatePem": "-----BEGIN CERTIFICATE-----\nMIIG/DCCBOSgAwIBAgIUGeK2VFaRPpGRlBrJjwipf6Eds1YwDQYJKoZIhvcNAQEL\nBQAwejEjMCEGCgmSJomT8ixkAQEME2MtMGZhMzliMzNlNTZlMDY1MTkxGTAXBgNV\nBAMMEFg1MDkgSWRlbnRpdHkgQ0ExGzAZBgNVBAsMEkNlcnRpZmljYXRlIElzc3Vl\ncjEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMB4XDTIwMDYwNTIwMDEwMFoX\nDTIxMDYwNTIwMDEwMFowNDEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMRUw\nEwYDVQQDDAxhZG1pbjoxMjM0NTYwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK\nAoIBAQDFu7NweJ79eNKwTkU30Zxd19lsABkNYAXJDqfyrsuT68eeR3nGz0uyQpEE\nSQs0Ob8o62JXvL0DnnAa5MK8yt+p9TiltJEOQXTMbrovFJnDR85BrZFQEbyCKyrz\n9WQTDwCEqv362dnkcwLBd2DObD8OvRg/UzuVoSA7tlsQzaASzpItUJFCuGKzHa0t\nb3Ttrhgz4Q9WPXgOOdKsLg6pouyGSEaXKyIhAcrLUjvnOcSjJbo46+y5iTemW5km\n3gNdbINVluCG3HVQ7zZpLoaYv447WUvFPMMSeRAYNRz2QoBOt8seofcwVvurcctm\ntL5WFlYNCH+eDkdFHUy3xdVrsibTAgMBAAGjggK+MIICujAMBgNVHRMBAf8EAjAA\nMB8GA1UdIwQYMBaAFFjCckdwxGbsWEEv3h/+sy1Cz5RgMIHcBgNVHS4EgdQwgdEw\ngc6ggcuggciGgcVodHRwOi8vMTcyLjE4LjAuMwoxNzIuMTkuMC40OjgwODAvZWpi\nY2EvcHVibGljd2ViL3dlYmRpc3QvY2VydGRpc3Q/Y21kPWRlbHRhY3JsJmlzc3Vl\ncj1VSUQlM0RjLTBmYTM5YjMzZTU2ZTA2NTE5JTJDQ04lM0RYNTA5JTIwSWRlbnRp\ndHklMjBDQSUyQ09VJTNEQ2VydGlmaWNhdGUlMjBJc3N1ZXIlMkNPJTNEZG9qb3Ql\nMjBJb1QlMjBQbGF0Zm9ybTAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwQw\nggFaBgNVHR8EggFRMIIBTTCCAUmggcaggcOGgcBodHRwOi8vMTcyLjE4LjAuMwox\nNzIuMTkuMC40OjgwODAvZWpiY2EvcHVibGljd2ViL3dlYmRpc3QvY2VydGRpc3Q/\nY21kPWNybCZpc3N1ZXI9VUlEJTNEYy0wZmEzOWIzM2U1NmUwNjUxOSUyQ0NOJTNE\nWDUwOSUyMElkZW50aXR5JTIwQ0ElMkNPVSUzRENlcnRpZmljYXRlJTIwSXNzdWVy\nJTJDTyUzRGRvam90JTIwSW9UJTIwUGxhdGZvcm2ifqR8MHoxIzAhBgoJkiaJk/Is\nZAEBDBNjLTBmYTM5YjMzZTU2ZTA2NTE5MRkwFwYDVQQDDBBYNTA5IElkZW50aXR5\nIENBMRswGQYDVQQLDBJDZXJ0aWZpY2F0ZSBJc3N1ZXIxGzAZBgNVBAoMEmRvam90\nIElvVCBQbGF0Zm9ybTAdBgNVHQ4EFgQUuNRRFLrgvwwHe8ShOhMWRISTXZYwDgYD\nVR0PAQH/BAQDAgPoMA0GCSqGSIb3DQEBCwUAA4ICAQCLOCwNFlG6lM3P3+ToiwLA\n33q+ZRnMTXIOzzOKpiaOWfBv55y3nZnHIKuTlNMsP0qiOfDdrdvtQTs5NVmwSfa+\nK0uNH+wFTO8XLgs+Ii7OvAB+UX7+Vo8uxFxPKAgJHOUBFjIZq0y2Le4p+PNtuEQR\ntB3cisT++sUVc6NCgmoRUsEjGxNXnyPVU40GJ9DlNYtlBu4h+FaxaAeeEz3xduU7\neXLjlXpSWSIcRzfGo+6wobENZordAvqz6Hp5o3sHSXhiXkNeO1B2A421bkkUhA7W\nWjE8IknN5QjlquFp5rQZABLTx2Qw7YqiRkLqAXLXM20+XnqKBQ3HjNgklC9CpBZi\nM/KJlEm8muiODENwUBZ6YSo1nsgWAO/YBJ8NAbzT6sUQybsSnCBp9DAOf0amdqYn\na45C0gOWSBXMcxjXXOcVxFdNCfVpFAi9c7Y/bCeYbWVXY8jQ6e3nKwvbvILXORl9\n+Pyqqw6qhToHbcOqdCWqoZoEBRRg06Vkm6r0d6yh/UcE/UHyKlgnRGFZdpFYlSvZ\nTB+4Paeq3wOKxAkjUs2SlFHZYT43+NKmsiSTf1yyKruwh1yMR0hAfRM9GCooOjvr\n5PokzscdSyNwWh/LrkUAvKnB/XgpgqeN+ngK8jVotieV4vLc7ji/i6ME1Czi0g9I\nLPSCByr/Jf5/sLD6GXNh4w==\n-----END CERTIFICATE-----"
    }

In the example above, we have two important observations to make:

 - The first is related to the *fingerprint* of the generated certificate: **A certificate's fingerprint is the unique identifier of the certificate.** Microsoft Internet Explorer calls it *Thumbprint*. Browsers tend to display it as if it were a part of the certificate. It is not a part of the certificate, but it is computed from it.
A fingerprint is the *digest* of the DER-Encoded Certificate Info (which is an ASN.1 type specified as part of the X.509 specification). The Certificate Fingerprint is a digest (hash function) of a certificate in x509 binary format. It can be calculated by different algorithms, such as MD5 or SHA1, **but we chose to work with SHA256**. Note that each pair of hexadecimal characters has been separated by colons. The result of the SHA256 hash function does not include this separation, but we chose to work with it as this is how the fingerprint is presented to the user.
 - The second is related to the certificate, notice that the line break markers are present there, however for the certificate to be used, it is necessary that these markers be replaced by the correct bytes that represent the line break. Note that it is the user's responsibility to save the certificate in [PEM format](https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail), respecting the limit of 64 bytes per line.

After extracting the response payload certificate and saving it to disk in a text file (PEM format), we will have the following result:

    -----BEGIN CERTIFICATE-----
    MIIG/DCCBOSgAwIBAgIUGeK2VFaRPpGRlBrJjwipf6Eds1YwDQYJKoZIhvcNAQEL
    BQAwejEjMCEGCgmSJomT8ixkAQEME2MtMGZhMzliMzNlNTZlMDY1MTkxGTAXBgNV
    BAMMEFg1MDkgSWRlbnRpdHkgQ0ExGzAZBgNVBAsMEkNlcnRpZmljYXRlIElzc3Vl
    cjEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMB4XDTIwMDYwNTIwMDEwMFoX
    DTIxMDYwNTIwMDEwMFowNDEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMRUw
    EwYDVQQDDAxhZG1pbjoxMjM0NTYwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK
    AoIBAQDFu7NweJ79eNKwTkU30Zxd19lsABkNYAXJDqfyrsuT68eeR3nGz0uyQpEE
    SQs0Ob8o62JXvL0DnnAa5MK8yt+p9TiltJEOQXTMbrovFJnDR85BrZFQEbyCKyrz
    9WQTDwCEqv362dnkcwLBd2DObD8OvRg/UzuVoSA7tlsQzaASzpItUJFCuGKzHa0t
    b3Ttrhgz4Q9WPXgOOdKsLg6pouyGSEaXKyIhAcrLUjvnOcSjJbo46+y5iTemW5km
    3gNdbINVluCG3HVQ7zZpLoaYv447WUvFPMMSeRAYNRz2QoBOt8seofcwVvurcctm
    tL5WFlYNCH+eDkdFHUy3xdVrsibTAgMBAAGjggK+MIICujAMBgNVHRMBAf8EAjAA
    MB8GA1UdIwQYMBaAFFjCckdwxGbsWEEv3h/+sy1Cz5RgMIHcBgNVHS4EgdQwgdEw
    gc6ggcuggciGgcVodHRwOi8vMTcyLjE4LjAuMwoxNzIuMTkuMC40OjgwODAvZWpi
    Y2EvcHVibGljd2ViL3dlYmRpc3QvY2VydGRpc3Q/Y21kPWRlbHRhY3JsJmlzc3Vl
    cj1VSUQlM0RjLTBmYTM5YjMzZTU2ZTA2NTE5JTJDQ04lM0RYNTA5JTIwSWRlbnRp
    dHklMjBDQSUyQ09VJTNEQ2VydGlmaWNhdGUlMjBJc3N1ZXIlMkNPJTNEZG9qb3Ql
    MjBJb1QlMjBQbGF0Zm9ybTAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwQw
    ggFaBgNVHR8EggFRMIIBTTCCAUmggcaggcOGgcBodHRwOi8vMTcyLjE4LjAuMwox
    NzIuMTkuMC40OjgwODAvZWpiY2EvcHVibGljd2ViL3dlYmRpc3QvY2VydGRpc3Q/
    Y21kPWNybCZpc3N1ZXI9VUlEJTNEYy0wZmEzOWIzM2U1NmUwNjUxOSUyQ0NOJTNE
    WDUwOSUyMElkZW50aXR5JTIwQ0ElMkNPVSUzRENlcnRpZmljYXRlJTIwSXNzdWVy
    JTJDTyUzRGRvam90JTIwSW9UJTIwUGxhdGZvcm2ifqR8MHoxIzAhBgoJkiaJk/Is
    ZAEBDBNjLTBmYTM5YjMzZTU2ZTA2NTE5MRkwFwYDVQQDDBBYNTA5IElkZW50aXR5
    IENBMRswGQYDVQQLDBJDZXJ0aWZpY2F0ZSBJc3N1ZXIxGzAZBgNVBAoMEmRvam90
    IElvVCBQbGF0Zm9ybTAdBgNVHQ4EFgQUuNRRFLrgvwwHe8ShOhMWRISTXZYwDgYD
    VR0PAQH/BAQDAgPoMA0GCSqGSIb3DQEBCwUAA4ICAQCLOCwNFlG6lM3P3+ToiwLA
    33q+ZRnMTXIOzzOKpiaOWfBv55y3nZnHIKuTlNMsP0qiOfDdrdvtQTs5NVmwSfa+
    K0uNH+wFTO8XLgs+Ii7OvAB+UX7+Vo8uxFxPKAgJHOUBFjIZq0y2Le4p+PNtuEQR
    tB3cisT++sUVc6NCgmoRUsEjGxNXnyPVU40GJ9DlNYtlBu4h+FaxaAeeEz3xduU7
    eXLjlXpSWSIcRzfGo+6wobENZordAvqz6Hp5o3sHSXhiXkNeO1B2A421bkkUhA7W
    WjE8IknN5QjlquFp5rQZABLTx2Qw7YqiRkLqAXLXM20+XnqKBQ3HjNgklC9CpBZi
    M/KJlEm8muiODENwUBZ6YSo1nsgWAO/YBJ8NAbzT6sUQybsSnCBp9DAOf0amdqYn
    a45C0gOWSBXMcxjXXOcVxFdNCfVpFAi9c7Y/bCeYbWVXY8jQ6e3nKwvbvILXORl9
    +Pyqqw6qhToHbcOqdCWqoZoEBRRg06Vkm6r0d6yh/UcE/UHyKlgnRGFZdpFYlSvZ
    TB+4Paeq3wOKxAkjUs2SlFHZYT43+NKmsiSTf1yyKruwh1yMR0hAfRM9GCooOjvr
    5PokzscdSyNwWh/LrkUAvKnB/XgpgqeN+ngK8jVotieV4vLc7ji/i6ME1Czi0g9I
    LPSCByr/Jf5/sLD6GXNh4w==
    -----END CERTIFICATE-----

With the certificate in hand, the device already has an identity and is almost ready to communicate (over TLS) with the dojot platform, but first, it is still necessary to recover the internal CA certificate of the dojot platform, which was responsible for sign the device certificate and who the device must trust for mutual TLS to be established.

This procedure is described below ...

### How to obtain the internal CA certificate of the dojot platform

The syntax for obtaining the internal CA certificate for the dojot platform that signs the certificates for devices is very simple:

    GET <base-url>/v1/ca
    Authorization: Bearer JWT

And having the following syntax as the answer:

    HTTP/1.1 200 Success
    Content-type: application/json
    {
        "certificateFingerprint": <string>,
        "caPem": <string>
    }

In practice, we will have something similar to this:

    HTTP/1.1 200 Success
    Content-type: application/json

    {
      "certificateFingerprint": "B9:7C:88:EE:A4:13:3E:64:99:44:C5:35:61:9D:4E:15:B7:70:A4:FD:78:61:70:22:D2:27:BC:74:15:AA:C5:CC",
      "caPem": "-----BEGIN CERTIFICATE-----\n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\n-----END CERTIFICATE-----"
    }

The answer is very similar to the one we have when requesting a certificate, just follow the same observations already made in the case of obtaining certificates for devices.

With the device certificate and the CA certificate that this device trusts (dojot internal CA) we can now establish secure communication (over TLS) with the platform.
At this point, the participation of the *X.509 Identity Management* component ends successfully.

### List issued certificates

There are two ways to obtain certificates issued by the dojot platform.

##### The first and simplest, is just to inform the certificate fingerprint in a GET request according to the syntax:

    GET <base-url>/v1/certificates/<certificateFingerprint>?fields=<list>

In practice, we would have something like this:

    GET <base-url>/v1/certificates/27:98:B3:A2:69:28:2C:C3:00:E2:2C:7D:48:50:94:C4:4A:F7:A2:1C:63:B8:06:7F:69:15:01:F6:EA:09:34:2D

And as an answer, we will have the following:

    HTTP/1.1 200 Success
    Content-type: application/json

    {
      "issuedByDojotPki": true,
      "autoRegistered": false,
      "fingerprint": "27:98:B3:A2:69:28:2C:C3:00:E2:2C:7D:48:50:94:C4:4A:F7:A2:1C:63:B8:06:7F:69:15:01:F6:EA:09:34:2D",
      "pem": "-----BEGIN CERTIFICATE-----\nMIIG/DCCBOSgAwIBAgIUGeK2VFaRPpGRlBrJjwipf6Eds1YwDQYJKoZIhvcNAQEL\nBQAwejEjMCEGCgmSJomT8ixkAQEME2MtMGZhMzliMzNlNTZlMDY1MTkxGTAXBgNV\nBAMMEFg1MDkgSWRlbnRpdHkgQ0ExGzAZBgNVBAsMEkNlcnRpZmljYXRlIElzc3Vl\ncjEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMB4XDTIwMDYwNTIwMDEwMFoX\nDTIxMDYwNTIwMDEwMFowNDEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMRUw\nEwYDVQQDDAxhZG1pbjoxMjM0NTYwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK\nAoIBAQDFu7NweJ79eNKwTkU30Zxd19lsABkNYAXJDqfyrsuT68eeR3nGz0uyQpEE\nSQs0Ob8o62JXvL0DnnAa5MK8yt+p9TiltJEOQXTMbrovFJnDR85BrZFQEbyCKyrz\n9WQTDwCEqv362dnkcwLBd2DObD8OvRg/UzuVoSA7tlsQzaASzpItUJFCuGKzHa0t\nb3Ttrhgz4Q9WPXgOOdKsLg6pouyGSEaXKyIhAcrLUjvnOcSjJbo46+y5iTemW5km\n3gNdbINVluCG3HVQ7zZpLoaYv447WUvFPMMSeRAYNRz2QoBOt8seofcwVvurcctm\ntL5WFlYNCH+eDkdFHUy3xdVrsibTAgMBAAGjggK+MIICujAMBgNVHRMBAf8EAjAA\nMB8GA1UdIwQYMBaAFFjCckdwxGbsWEEv3h/+sy1Cz5RgMIHcBgNVHS4EgdQwgdEw\ngc6ggcuggciGgcVodHRwOi8vMTcyLjE4LjAuMwoxNzIuMTkuMC40OjgwODAvZWpi\nY2EvcHVibGljd2ViL3dlYmRpc3QvY2VydGRpc3Q/Y21kPWRlbHRhY3JsJmlzc3Vl\ncj1VSUQlM0RjLTBmYTM5YjMzZTU2ZTA2NTE5JTJDQ04lM0RYNTA5JTIwSWRlbnRp\ndHklMjBDQSUyQ09VJTNEQ2VydGlmaWNhdGUlMjBJc3N1ZXIlMkNPJTNEZG9qb3Ql\nMjBJb1QlMjBQbGF0Zm9ybTAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwQw\nggFaBgNVHR8EggFRMIIBTTCCAUmggcaggcOGgcBodHRwOi8vMTcyLjE4LjAuMwox\nNzIuMTkuMC40OjgwODAvZWpiY2EvcHVibGljd2ViL3dlYmRpc3QvY2VydGRpc3Q/\nY21kPWNybCZpc3N1ZXI9VUlEJTNEYy0wZmEzOWIzM2U1NmUwNjUxOSUyQ0NOJTNE\nWDUwOSUyMElkZW50aXR5JTIwQ0ElMkNPVSUzRENlcnRpZmljYXRlJTIwSXNzdWVy\nJTJDTyUzRGRvam90JTIwSW9UJTIwUGxhdGZvcm2ifqR8MHoxIzAhBgoJkiaJk/Is\nZAEBDBNjLTBmYTM5YjMzZTU2ZTA2NTE5MRkwFwYDVQQDDBBYNTA5IElkZW50aXR5\nIENBMRswGQYDVQQLDBJDZXJ0aWZpY2F0ZSBJc3N1ZXIxGzAZBgNVBAoMEmRvam90\nIElvVCBQbGF0Zm9ybTAdBgNVHQ4EFgQUuNRRFLrgvwwHe8ShOhMWRISTXZYwDgYD\nVR0PAQH/BAQDAgPoMA0GCSqGSIb3DQEBCwUAA4ICAQCLOCwNFlG6lM3P3+ToiwLA\n33q+ZRnMTXIOzzOKpiaOWfBv55y3nZnHIKuTlNMsP0qiOfDdrdvtQTs5NVmwSfa+\nK0uNH+wFTO8XLgs+Ii7OvAB+UX7+Vo8uxFxPKAgJHOUBFjIZq0y2Le4p+PNtuEQR\ntB3cisT++sUVc6NCgmoRUsEjGxNXnyPVU40GJ9DlNYtlBu4h+FaxaAeeEz3xduU7\neXLjlXpSWSIcRzfGo+6wobENZordAvqz6Hp5o3sHSXhiXkNeO1B2A421bkkUhA7W\nWjE8IknN5QjlquFp5rQZABLTx2Qw7YqiRkLqAXLXM20+XnqKBQ3HjNgklC9CpBZi\nM/KJlEm8muiODENwUBZ6YSo1nsgWAO/YBJ8NAbzT6sUQybsSnCBp9DAOf0amdqYn\na45C0gOWSBXMcxjXXOcVxFdNCfVpFAi9c7Y/bCeYbWVXY8jQ6e3nKwvbvILXORl9\n+Pyqqw6qhToHbcOqdCWqoZoEBRRg06Vkm6r0d6yh/UcE/UHyKlgnRGFZdpFYlSvZ\nTB+4Paeq3wOKxAkjUs2SlFHZYT43+NKmsiSTf1yyKruwh1yMR0hAfRM9GCooOjvr\n5PokzscdSyNwWh/LrkUAvKnB/XgpgqeN+ngK8jVotieV4vLc7ji/i6ME1Czi0g9I\nLPSCByr/Jf5/sLD6GXNh4w==\n-----END CERTIFICATE-----",
      "belongsTo": {},
      "tenant": "admin",
      "createdAt": "2020-06-05T20:01:11.286Z"
    }

The optional **fields** parameter in the URL can be used to redefine the content of the response, being able to list only the desired fields separated by commas:

For example, in the request:

    GET <base-url>/v1/certificates/27:98:B3:A2:69:28:2C:C3:00:E2:2C:7D:48:50:94:C4:4A:F7:A2:1C:63:B8:06:7F:69:15:01:F6:EA:09:34:2D?fields=pem,createdAt

We would have the platform's response:

    HTTP/1.1 200 Success
    Content-type: application/json

    {
      "pem": "-----BEGIN CERTIFICATE-----\nMIIG/DCCBOSgAwIBAgIUGeK2VFaRPpGRlBrJjwipf6Eds1YwDQYJKoZIhvcNAQEL\nBQAwejEjMCEGCgmSJomT8ixkAQEME2MtMGZhMzliMzNlNTZlMDY1MTkxGTAXBgNV\nBAMMEFg1MDkgSWRlbnRpdHkgQ0ExGzAZBgNVBAsMEkNlcnRpZmljYXRlIElzc3Vl\ncjEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMB4XDTIwMDYwNTIwMDEwMFoX\nDTIxMDYwNTIwMDEwMFowNDEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMRUw\nEwYDVQQDDAxhZG1pbjoxMjM0NTYwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK\nAoIBAQDFu7NweJ79eNKwTkU30Zxd19lsABkNYAXJDqfyrsuT68eeR3nGz0uyQpEE\nSQs0Ob8o62JXvL0DnnAa5MK8yt+p9TiltJEOQXTMbrovFJnDR85BrZFQEbyCKyrz\n9WQTDwCEqv362dnkcwLBd2DObD8OvRg/UzuVoSA7tlsQzaASzpItUJFCuGKzHa0t\nb3Ttrhgz4Q9WPXgOOdKsLg6pouyGSEaXKyIhAcrLUjvnOcSjJbo46+y5iTemW5km\n3gNdbINVluCG3HVQ7zZpLoaYv447WUvFPMMSeRAYNRz2QoBOt8seofcwVvurcctm\ntL5WFlYNCH+eDkdFHUy3xdVrsibTAgMBAAGjggK+MIICujAMBgNVHRMBAf8EAjAA\nMB8GA1UdIwQYMBaAFFjCckdwxGbsWEEv3h/+sy1Cz5RgMIHcBgNVHS4EgdQwgdEw\ngc6ggcuggciGgcVodHRwOi8vMTcyLjE4LjAuMwoxNzIuMTkuMC40OjgwODAvZWpi\nY2EvcHVibGljd2ViL3dlYmRpc3QvY2VydGRpc3Q/Y21kPWRlbHRhY3JsJmlzc3Vl\ncj1VSUQlM0RjLTBmYTM5YjMzZTU2ZTA2NTE5JTJDQ04lM0RYNTA5JTIwSWRlbnRp\ndHklMjBDQSUyQ09VJTNEQ2VydGlmaWNhdGUlMjBJc3N1ZXIlMkNPJTNEZG9qb3Ql\nMjBJb1QlMjBQbGF0Zm9ybTAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwQw\nggFaBgNVHR8EggFRMIIBTTCCAUmggcaggcOGgcBodHRwOi8vMTcyLjE4LjAuMwox\nNzIuMTkuMC40OjgwODAvZWpiY2EvcHVibGljd2ViL3dlYmRpc3QvY2VydGRpc3Q/\nY21kPWNybCZpc3N1ZXI9VUlEJTNEYy0wZmEzOWIzM2U1NmUwNjUxOSUyQ0NOJTNE\nWDUwOSUyMElkZW50aXR5JTIwQ0ElMkNPVSUzRENlcnRpZmljYXRlJTIwSXNzdWVy\nJTJDTyUzRGRvam90JTIwSW9UJTIwUGxhdGZvcm2ifqR8MHoxIzAhBgoJkiaJk/Is\nZAEBDBNjLTBmYTM5YjMzZTU2ZTA2NTE5MRkwFwYDVQQDDBBYNTA5IElkZW50aXR5\nIENBMRswGQYDVQQLDBJDZXJ0aWZpY2F0ZSBJc3N1ZXIxGzAZBgNVBAoMEmRvam90\nIElvVCBQbGF0Zm9ybTAdBgNVHQ4EFgQUuNRRFLrgvwwHe8ShOhMWRISTXZYwDgYD\nVR0PAQH/BAQDAgPoMA0GCSqGSIb3DQEBCwUAA4ICAQCLOCwNFlG6lM3P3+ToiwLA\n33q+ZRnMTXIOzzOKpiaOWfBv55y3nZnHIKuTlNMsP0qiOfDdrdvtQTs5NVmwSfa+\nK0uNH+wFTO8XLgs+Ii7OvAB+UX7+Vo8uxFxPKAgJHOUBFjIZq0y2Le4p+PNtuEQR\ntB3cisT++sUVc6NCgmoRUsEjGxNXnyPVU40GJ9DlNYtlBu4h+FaxaAeeEz3xduU7\neXLjlXpSWSIcRzfGo+6wobENZordAvqz6Hp5o3sHSXhiXkNeO1B2A421bkkUhA7W\nWjE8IknN5QjlquFp5rQZABLTx2Qw7YqiRkLqAXLXM20+XnqKBQ3HjNgklC9CpBZi\nM/KJlEm8muiODENwUBZ6YSo1nsgWAO/YBJ8NAbzT6sUQybsSnCBp9DAOf0amdqYn\na45C0gOWSBXMcxjXXOcVxFdNCfVpFAi9c7Y/bCeYbWVXY8jQ6e3nKwvbvILXORl9\n+Pyqqw6qhToHbcOqdCWqoZoEBRRg06Vkm6r0d6yh/UcE/UHyKlgnRGFZdpFYlSvZ\nTB+4Paeq3wOKxAkjUs2SlFHZYT43+NKmsiSTf1yyKruwh1yMR0hAfRM9GCooOjvr\n5PokzscdSyNwWh/LrkUAvKnB/XgpgqeN+ngK8jVotieV4vLc7ji/i6ME1Czi0g9I\nLPSCByr/Jf5/sLD6GXNh4w==\n-----END CERTIFICATE-----",
      "createdAt": "2020-06-05T20:01:11.286Z"
    }

##### The second option makes it possible to list several certificates.
The syntax for the listing is given below:

    GET <base-url>/v1/certificates?page=<number>&limit=<number>&fields=<list>&key1=val1&...&keyn=valn

    Authorization: Bearer JWT

Since the parameters informed in the URL are optional and in case they are not informed, the list presents the first 25 elements (configurable value).
Below are detailed the parameters that can be informed in the URL:

| Parameter | Description |
|-----------|-------------|
| page      | It is a metadata for paginated results. It identifies the position of the first document to be returned; if not set, the value 1 is assumed. Type: Number (>0). |
| limit     | It is a metadata for paginated results. It defines the maximum number of documents (items) to be returned; if not set, the value 25 is assumed. Type: Number(>0, <=250) |
| fields    | List of keys that should be included in the result. If the fields parameter is not set, all keys will be kept in the result. Type: list of keys separated by a comma |
| key=val   | Filters the returned documents by the given key=val. If more than one key=val pair is set; the returned documents must contain all of them. Type: [MongoDB query parameters](https://www.npmjs.com/package/mongo-querystring) |

The response syntax would be as follows:

    HTTP/1.1 200 Success
    Content-type: application/json

    {
        "paging": {
            "previous": {
                "number": 1,
                "url": "/x509/v1/certificates?page=1&..."
            },
            "current": {
                "number": 2,
                "url": "/x509/v1/certificates?page=2&..."
            },
            "next": {
                "number": 3,
                "url": "/x509/v1/certificates?page=3&..."
            },
            "totalItems": 60,
            "totalPages": 12,
            "limitPerPage": 5
        },
        "certificates": [
            ... same as Get x.509 Certificate ...
        ]
    }

Response Elements

| Key | Description |
|--|--|
| certificates | List of x509 certificates according to the query parameters. Each element of the array is the same as specified by Get x509 Certificate. Type: Array |
| paging | Metadata for controlling paginated results. It contains the URIs for the *previous*, *current* and *next* page. The *previous* and *next* will assume *null* value when there is no page. Type: Document with keys previous and next. |

A practical example query would be:

    GET <base-url>/v1/certificates?page=2&limit=3&fields=pem&fingerprint=~:44

In this case, we are looking at *page* 2, the *limit* of elements per page must be 3 and we only want the *key "pem"* of each element found, and the filter used for this is the *fingerprint* containing the string *":44"*.

The platform's response could be something like:

    HTTP/1.1 200 Success
    Content-type: application/json

    {
      "paging": {
        "previous": {
          "number": 1,
          "url": "/x509/v1/certificates?page=1&limit=3&fields=pem%2Cfingerprint&fingerprint=~%3A44"
      },
        "current": {
          "number": 2,
          "url": "/x509/v1/certificates?page=2&limit=3&fields=pem%2Cfingerprint&fingerprint=~%3A44"
        },
        "next": {
          "number": 3,
          "url": "/x509/v1/certificates?page=3&limit=3&fields=pem%2Cfingerprint&fingerprint=~%3A44"
        },
        "totalItems": 9,
        "totalPages": 3,
        "limitPerPage": 3
      },
      "certificates": [
        {
          "fingerprint": "77:68:FF:6D:6C:64:88:97:FA:DE:98:6C:E3:7A:3D:AA:1C:52:6F:BF:25:AF:44:B6:02:7F:53:AD:B5:3B:01:C4",
          "pem": "-----BEGIN CERTIFICATE-----\nMIIGRjCCBC6gAwIBAgIURc9riMHOsrnULG9INEC0edGW2RgwDQYJKoZIhvcNAQEL\nBQAwejEjMCEGCgmSJomT8ixkAQEME2MtMGZhMzliMzNlNTZlMDY1MTkxGTAXBgNV\nBAMMEFg1MDkgSWRlbnRpdHkgQ0ExGzAZBgNVBAsMEkNlcnRpZmljYXRlIElzc3Vl\ncjEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMB4XDTIwMDYwNjIxMDcwMFoX\nDTIxMDYwNjIxMDcwMFowSTEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMSow\nKAYDVQQDDCFhZG1pbjpFQ0MgcHJpbWUyNTZ2MSBUaGlhZ28gVGVzdGUwWTATBgcq\nhkjOPQIBBggqhkjOPQMBBwNCAAScpvJvi3wQGER+b2CQ3/E+Nw+ddTCu2fv5sF/E\nBqVe0tWQu1rWPDmrwmjkIOM33e1fo0SzeNaDrDurPEx7OTAOo4ICvjCCArowDAYD\nVR0TAQH/BAIwADAfBgNVHSMEGDAWgBRYwnJHcMRm7FhBL94f/rMtQs+UYDCB3AYD\nVR0uBIHUMIHRMIHOoIHLoIHIhoHFaHR0cDovLzE3Mi4xOC4wLjMKMTcyLjE5LjAu\nNDo4MDgwL2VqYmNhL3B1YmxpY3dlYi93ZWJkaXN0L2NlcnRkaXN0P2NtZD1kZWx0\nYWNybCZpc3N1ZXI9VUlEJTNEYy0wZmEzOWIzM2U1NmUwNjUxOSUyQ0NOJTNEWDUw\nOSUyMElkZW50aXR5JTIwQ0ElMkNPVSUzRENlcnRpZmljYXRlJTIwSXNzdWVyJTJD\nTyUzRGRvam90JTIwSW9UJTIwUGxhdGZvcm0wHQYDVR0lBBYwFAYIKwYBBQUHAwIG\nCCsGAQUFBwMEMIIBWgYDVR0fBIIBUTCCAU0wggFJoIHGoIHDhoHAaHR0cDovLzE3\nMi4xOC4wLjMKMTcyLjE5LjAuNDo4MDgwL2VqYmNhL3B1YmxpY3dlYi93ZWJkaXN0\nL2NlcnRkaXN0P2NtZD1jcmwmaXNzdWVyPVVJRCUzRGMtMGZhMzliMzNlNTZlMDY1\nMTklMkNDTiUzRFg1MDklMjBJZGVudGl0eSUyMENBJTJDT1UlM0RDZXJ0aWZpY2F0\nZSUyMElzc3VlciUyQ08lM0Rkb2pvdCUyMElvVCUyMFBsYXRmb3Jton6kfDB6MSMw\nIQYKCZImiZPyLGQBAQwTYy0wZmEzOWIzM2U1NmUwNjUxOTEZMBcGA1UEAwwQWDUw\nOSBJZGVudGl0eSBDQTEbMBkGA1UECwwSQ2VydGlmaWNhdGUgSXNzdWVyMRswGQYD\nVQQKDBJkb2pvdCBJb1QgUGxhdGZvcm0wHQYDVR0OBBYEFD1vcBmX/6Of+o7t8eis\nKz8AyLtgMA4GA1UdDwEB/wQEAwID6DANBgkqhkiG9w0BAQsFAAOCAgEAj5PQBQqV\ntZGKiG3RT1v4jE3KwrVadL/L73CHVaBVMEUtIOxE4TOu8eAMPJgiESyu2e8Ga5Na\nu2lRXbdRLv3y4jy8AsHjyylLVYfzLaM+HRZYRLUYX8iHWROdAnfcH9o/INgFnQ4H\nA4C+kn2VEDjhKuK064WNAkLkC/4AYq1TZUWY9CT5jGOLy74Xks1HP4QnZ00iidnj\nXvAJcezWYqZL3ssY3nX/S3m9lsiDLq6qFqs9ZmUzo1NgvRZ/HGWVM/srwEuFujef\ntxoCguC17ctdNYEs09Z7fXSI3uRLfvt4NcO32PFgWZf0fiJxm8auj6pjDMg9Iq/K\nGO7xWyHQmBXNHa2oB/UKw04tgZukBLHm6kKzXN4KPss300dhsigRcWfmcTycfmvI\nb38l45nuycDWEvakSpXdqnYhCWrIaJ5P4OsVDgeQt9zPcyuvkxYlc+v2jrTzoyT7\nD0793JXqb1nHvxxZNJQIulQ3eAfHQCzQsoRBmvJWzbFCBb9/ABBHEtXTbGQuOdSY\ncb3fSdaRSuWQ1TL3lBaC3mDc1pJvDA71KYb9MK4ZDRaj+s8eLcokZaQEussEaIU0\nTgAxiQf4tnnlBkmyTB4DoX3QNNTjZv6U14VaZzcYznrCBSpnWNB0kEwksGGhlpNN\nkUvlhea7lgyv3pmBPVm1z7ZU4B4cmcOcuYA=\n-----END CERTIFICATE-----"
        },
        {
          "fingerprint": "8E:C8:5E:44:7F:BC:E9:77:F4:BB:9F:8B:0D:3B:A2:B0:E4:88:1F:5A:D3:40:3A:31:2A:3D:2F:A2:DF:B1:DB:CB",
          "pem": "-----BEGIN CERTIFICATE-----\nMIIGijCCBHKgAwIBAgIUeDha2NP+nHzIJqitXVTORoM/hQIwDQYJKoZIhvcNAQEL\nBQAwejEjMCEGCgmSJomT8ixkAQEME2MtMGZhMzliMzNlNTZlMDY1MTkxGTAXBgNV\nBAMMEFg1MDkgSWRlbnRpdHkgQ0ExGzAZBgNVBAsMEkNlcnRpZmljYXRlIElzc3Vl\ncjEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMB4XDTIwMDYwNjIxMDgwMFoX\nDTIxMDYwNjIxMDgwMFowSjEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMSsw\nKQYDVQQDDCJhZG1pbjpUZXN0ZSBkZSBjaGF2ZSBFQ0Mgc2VjcDUyMXIxMIGbMBAG\nByqGSM49AgEGBSuBBAAjA4GGAAQAnBJFrKXkqraaEEpxxvJRx9NUU/NzyPKQkX2f\nnaUQxn6e9Q88BtskqrvkpNeEd6BJP43EuGsrG54wmCmG/HeTAD0BHcvIpcbPgEd7\nUcS4LHtt3DPKuqazet7tD8zlLShs6dCSM3djr+kArxcSjNCJG0iPgEME53Er3jbK\nWbhznLHMUZ2jggK+MIICujAMBgNVHRMBAf8EAjAAMB8GA1UdIwQYMBaAFFjCckdw\nxGbsWEEv3h/+sy1Cz5RgMIHcBgNVHS4EgdQwgdEwgc6ggcuggciGgcVodHRwOi8v\nMTcyLjE4LjAuMwoxNzIuMTkuMC40OjgwODAvZWpiY2EvcHVibGljd2ViL3dlYmRp\nc3QvY2VydGRpc3Q/Y21kPWRlbHRhY3JsJmlzc3Vlcj1VSUQlM0RjLTBmYTM5YjMz\nZTU2ZTA2NTE5JTJDQ04lM0RYNTA5JTIwSWRlbnRpdHklMjBDQSUyQ09VJTNEQ2Vy\ndGlmaWNhdGUlMjBJc3N1ZXIlMkNPJTNEZG9qb3QlMjBJb1QlMjBQbGF0Zm9ybTAd\nBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwQwggFaBgNVHR8EggFRMIIBTTCC\nAUmggcaggcOGgcBodHRwOi8vMTcyLjE4LjAuMwoxNzIuMTkuMC40OjgwODAvZWpi\nY2EvcHVibGljd2ViL3dlYmRpc3QvY2VydGRpc3Q/Y21kPWNybCZpc3N1ZXI9VUlE\nJTNEYy0wZmEzOWIzM2U1NmUwNjUxOSUyQ0NOJTNEWDUwOSUyMElkZW50aXR5JTIw\nQ0ElMkNPVSUzRENlcnRpZmljYXRlJTIwSXNzdWVyJTJDTyUzRGRvam90JTIwSW9U\nJTIwUGxhdGZvcm2ifqR8MHoxIzAhBgoJkiaJk/IsZAEBDBNjLTBmYTM5YjMzZTU2\nZTA2NTE5MRkwFwYDVQQDDBBYNTA5IElkZW50aXR5IENBMRswGQYDVQQLDBJDZXJ0\naWZpY2F0ZSBJc3N1ZXIxGzAZBgNVBAoMEmRvam90IElvVCBQbGF0Zm9ybTAdBgNV\nHQ4EFgQUKf1jtwgfqvEOnc4mHsYdeVSjSJMwDgYDVR0PAQH/BAQDAgPoMA0GCSqG\nSIb3DQEBCwUAA4ICAQBGIHWpbcnZfvRf5RHnfKnvuey6ksMwu6UwskPwSq1DhWwx\ng1w50xIDxw+QGKWnOrM9AhJWp1mOnO1H0TAxRoXV3l/+pdhHQCtK3t1eEcDM+fyU\nOg8HEotkykYOuu0+Dc8WrhWU96aGwP2zd2zJMhk/BfYleK61Nk9zOvUzVFfzo6ac\n8sdHsxtnlEFsUXhnqFf8d2yYYIuDd1Et6nlLqq8p6pOnSb4BuqtWi53oXOc+x6MT\n5OsVgYJQ3IZrpgosCnqxq3myFse+qrY5jPtvMAjhqk9hvB/9R160WmZjV8PlOpeX\nqSnJQgCxD7S7EF+F8PGlKZNlpxVDhpyKlxpBK8OPYPRqxzjPZyzC1OuYt78VLHh4\np0zteX5QokfII8CY3I0PfOl1icatFvt4f9GEa/l3D0k9NM4uTka8fDEBQbhsycyJ\nBTDEcgr01zFqEUsg3tg7NN7s2/ky/Legsb5b4WF2lnG7cYhf7IXPG0gECjc1q4cb\nHLC69uDfBthIPE6mAxaL/JEoDF8RsNiYTQsP5+6MxWoFuD6NL4nL6K8WE5rttfeV\n34f+UPkC6mAEbYQLS2zOLK+92wwRWdWwxIQu+yP1d3aNaj9XHxjKUkpSY9Lj0mdU\ns/TJfx7Verz6j0/E4ZucR8fiYK+k1b1rvE3NAHP20wCaQw33Y1Vtyn/ru9CYZw==\n-----END CERTIFICATE-----"
        },
        {
          "fingerprint": "B9:6B:39:F3:4A:1C:44:FB:16:6F:49:E2:0B:19:67:8B:27:45:D4:6B:76:B0:76:1D:3B:8B:1D:90:75:FB:BB:85",
          "pem": "-----BEGIN CERTIFICATE-----\nMIIGSDCCBDCgAwIBAgIUJJfmrkQJHdNWIrXCsR2dp67jj2swDQYJKoZIhvcNAQEL\nBQAwejEjMCEGCgmSJomT8ixkAQEME2MtMGZhMzliMzNlNTZlMDY1MTkxGTAXBgNV\nBAMMEFg1MDkgSWRlbnRpdHkgQ0ExGzAZBgNVBAsMEkNlcnRpZmljYXRlIElzc3Vl\ncjEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMB4XDTIwMDYwNjIxMTMwMFoX\nDTIxMDYwNjIxMTMwMFowSzEbMBkGA1UECgwSZG9qb3QgSW9UIFBsYXRmb3JtMSww\nKgYDVQQDDCNhZG1pbjpUZXN0ZSBkZSBjaGF2ZSBFQ0MgcHJpbWUyNTZ2MTBZMBMG\nByqGSM49AgEGCCqGSM49AwEHA0IABOX06A6uSaC7iS0kXo33kTSXoT2Q/80vRdXk\nNjNcyYXqZSmwHn33XKS0k8Ij2wNel5vIQe+NPs3B5opP1MtYvkujggK+MIICujAM\nBgNVHRMBAf8EAjAAMB8GA1UdIwQYMBaAFFjCckdwxGbsWEEv3h/+sy1Cz5RgMIHc\nBgNVHS4EgdQwgdEwgc6ggcuggciGgcVodHRwOi8vMTcyLjE4LjAuMwoxNzIuMTku\nMC40OjgwODAvZWpiY2EvcHVibGljd2ViL3dlYmRpc3QvY2VydGRpc3Q/Y21kPWRl\nbHRhY3JsJmlzc3Vlcj1VSUQlM0RjLTBmYTM5YjMzZTU2ZTA2NTE5JTJDQ04lM0RY\nNTA5JTIwSWRlbnRpdHklMjBDQSUyQ09VJTNEQ2VydGlmaWNhdGUlMjBJc3N1ZXIl\nMkNPJTNEZG9qb3QlMjBJb1QlMjBQbGF0Zm9ybTAdBgNVHSUEFjAUBggrBgEFBQcD\nAgYIKwYBBQUHAwQwggFaBgNVHR8EggFRMIIBTTCCAUmggcaggcOGgcBodHRwOi8v\nMTcyLjE4LjAuMwoxNzIuMTkuMC40OjgwODAvZWpiY2EvcHVibGljd2ViL3dlYmRp\nc3QvY2VydGRpc3Q/Y21kPWNybCZpc3N1ZXI9VUlEJTNEYy0wZmEzOWIzM2U1NmUw\nNjUxOSUyQ0NOJTNEWDUwOSUyMElkZW50aXR5JTIwQ0ElMkNPVSUzRENlcnRpZmlj\nYXRlJTIwSXNzdWVyJTJDTyUzRGRvam90JTIwSW9UJTIwUGxhdGZvcm2ifqR8MHox\nIzAhBgoJkiaJk/IsZAEBDBNjLTBmYTM5YjMzZTU2ZTA2NTE5MRkwFwYDVQQDDBBY\nNTA5IElkZW50aXR5IENBMRswGQYDVQQLDBJDZXJ0aWZpY2F0ZSBJc3N1ZXIxGzAZ\nBgNVBAoMEmRvam90IElvVCBQbGF0Zm9ybTAdBgNVHQ4EFgQU6HusqT6OTWtfZEzP\nKp/Vwg9vOeAwDgYDVR0PAQH/BAQDAgPoMA0GCSqGSIb3DQEBCwUAA4ICAQC84YXy\nXr55KV2pWLxwbcos/PIIzz7ttTyRqBfsWtPgN23UsCD87+5SrhzuEynMb2tbhL78\n/DrYiaXtjy+QFIcUxrwuN6J8w2opotXkQop2mV09I/0cg/lY8RGyyGL6KJAef5gh\n8ujuje5oB6iFkOB2PiEyLYif9Vj+GluJik505raQK79KLULEnZALLjWQczUR76KU\nh/zTGS9B5aq2zmoYyH3lUQ73bt4Xt8LfzcjXie3cz93zJ9gNVTQspD1MpQGEdv+G\nIjdlVuNaIjwQclrT7PmKy4VIPzXOHaCxQlrbkySJCoqQbDjSYyPVVxxXcH7kWvJ9\nSypDu0wZEuL7D0TPh93cdcNIIV0QC8C72u4G54jZVGajwGGnLw8MGxEgOTAdPSC4\nkruRc15JoKfwussIC4LcXov1Q/xxfq22nfAKKgY4R6HG32XsLY4EAQwYkwLw2X97\nU2mPkhDRW5ikxHLLRKGwMb5menc4aX4zzRBGkiTxTu/RrUvHsoeLPvm7n2swyeup\nvAhZ7/Fh8Yv98vWLIBeO8p5Rg3mOAUKaAmz6yzbxSAKnV4XJi5QBjxnPJTHwOhbw\ndFZhNmcqeavnrbcx3gtmWSlg5/0VoYk0j4LByMpqvSmu/ygA60/uRJ8jzNBOHI2d\naCgQ6zhUKqzvBpr2WUhlnT8UYUG/jWmTLgy/ZQ==\n-----END CERTIFICATE-----"
        }
      ]
    }

### How to revoke a certificate

Revoking certificates on the dojot platform has the same meaning as revoking certificates on a [PKI](https://en.wikipedia.org/wiki/Public_key_infrastructure). The certificate revocation process consists of the user informing that a certificate (still within the validity period) should no longer be accepted by the platform. This is usually done when the certificate's private key has been compromised.
**The platform does not revoke the certificate instantly**, what happens is that from time to time (configurable value), the platform generates [CRLs](https://en.wikipedia.org/wiki/Certificate_revocation_list) (Certificate revocation list) and makes them available to the *Device Broker*. The *Broker*, in turn, has the time to update its CRL. Keep in mind that for the platform as a whole, this process is very expensive to execute with each revocation request, therefore, remember that a certificate is still valid as soon as the user requests its revocation, this takes a certain time (configurable) until the platform updates its CRLs.

The syntax for revoking a certificate issued by the dojot platform is as follows:

    DELETE <base-url>/v1/certificates/<certificateFingerprint>

    Authorization: Bearer JWT

The `certificateFingerprint` is the same as that informed when the certificate was issued. Of course, it is also possible to calculate it using the SHA256 hash function, note that the dojot platform works with the colon character as a separator for each pair of bytes (represented in the hexadecimal base).

In practice, we would have something like this:

    DELETE <base-url>/v1/certificates/27:98:B3:A2:69:28:2C:C3:00:E2:2C:7D:48:50:94:C4:4A:F7:A2:1C:63:B8:06:7F:69:15:01:F6:EA:09:34:2D

The answer would be a simple confirmation:

    HTTP/1.1 204 No Content

